<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
       body {
            background-color: #DCEAD6;
            font-family: Arial, sans-serif;
        }
        .header {
            background-color: #DCEAD6;
            padding: 15px;
        }
        .container {
            max-width: 900px;
            background-color: #DCEAD6;
        }
        .progress {
            height: 20px;
        }
        .progress-bar {
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>

<header>
    <!-- Header -->
    <header class="header d-flex justify-content-between align-items-center">
        <h1 class="h3 text-success mb-0 ps-3">MOMENTUM</h1>
        <nav>
            <a href="/" class="btn btn-link">Home</a>
            <a href="/activities" class="btn btn-link">Activities</a>
            <a href="/nutrition" class="btn btn-link">Nutrition</a>
            <a href="/communities" class="btn btn-link">Communities</a>
            <a href="/logout" class="btn btn-outline-danger">Logout</a>
        </nav>
    </head>
    </header>
<body>
    <div class="container Edge 12, Firefox 1, Safari 1, Chrome 1, IE 4, Opera 3 shadow rounded">
        <h2 class="text-center mb-3">üèãÔ∏è Workout Tracker</h2>

        <!-- Workout Progress Chart -->
        <canvas id="workoutChart"></canvas>

        <!-- Workout History Table -->
        <h3 class="mt-4"> Workout History</h3>
        <table class="table table-hover table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>Date</th>
                    <th>Workout Type</th>
                    <th>Duration (min)</th>
                   
                </tr>
            </thead>
            <tbody>
                <% workouts.forEach(workout => { %>
                    <% if (!["weight", "bmi", "bodyFat", "muscleMass"].includes(workout.category)) { %> 
                        <tr>
                            <td><%= new Date(workout.date_logged + 'Z').toLocaleString() %></td>
                            <td><%= workout.category %></td>
                            <td><%= workout.value %> min</td>
                        </tr>
                    <% } %>
                <% }) %>
            </tbody>
            
        </table>

        <!-- Workout Completion Progress -->
        <h4 class="mt-4">Your Progress</h4>
        <div class="progress mb-4">
            <% let progressPercent = workouts.length > 0 ? (workouts.length * 10) : 0; %>
            <div class="progress-bar bg-success" role="progressbar" style="width: <%= progressPercent %>%;">
                <%= progressPercent %>% Completed
            </div>
        </div>

        <!-- Log a New Workout Form -->
        <h3 class="mt-4"> Log a New Workout</h3>
        <form action="/log/workout" method="POST">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Workout Type</label>
                    <select class="form-control" name="category" required>
                        <option value="Cardio">Cardio</option>
                        <option value="Strength"> Strength Training</option>
                        <option value="Flexibility"> Flexibility</option>
                        <option value="Yoga">Yoga</option>
                        <option value="Running">Running</option>
                        <option value="Cycling"> Cycling</option>
                    </select>
                </div>

                <div class="col-md-3 mb-3">
                    <label class="form-label">Duration (min)</label>
                    <input type="number" class="form-control" name="duration" required>
                </div>

                
            </div>

            <button type="submit" class="btn btn-primary"> Log Workout</button>
        </form>

        <hr>
        <a href="/activities" class="btn btn-secondary"> Back to Activities</a>
    </div>

    <!-- Chart.js-->
    <script>
        let progressData = <%- JSON.stringify(workouts || []) %>;
    
        // Filter only actual workouts (not BMI, weight, etc.)
        let filteredData = progressData.filter(entry => 
            !["weight", "bmi", "bodyFat", "muscleMass"].includes(entry.category)
        );
    
        // Sort Data Chronologically (Oldest to Newest)
        filteredData.sort((a, b) => new Date(a.date_logged) - new Date(b.date_logged));
    
        // Extract Labels (Time) & Data (Duration)
        const labels = filteredData.map(entry => 
            new Date(entry.date_logged + 'Z').toLocaleString('en-US', { 
                year: 'numeric', month: '2-digit', day: '2-digit', 
                hour: '2-digit', minute: '2-digit', hour12: true 
            })
        );
        const dataValues = filteredData.map(entry => entry.value);
    
        // Fix: Ensure Chart Updates Properly
        let ctx = document.getElementById("workoutChart").getContext("2d");
        let chart = new Chart(ctx, {
            type: "line",
            data: {
                labels: labels,
                datasets: [{
                    label: "Workout Progress",
                    data: dataValues,
                    borderColor: "#3e95cd",
                    backgroundColor: "rgba(62, 149, 205, 0.2)",
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: true }
                },
                scales: {
                    x: { title: { display: true, text: "Date & Time" } },
                    y: { title: { display: true, text: "Workout Duration (min)" } }
                }
                
            }
        });
    
        // Auto-Refresh Page After Logging a Workout
        function refreshAfterLogging() {
            setTimeout(() => {
                location.reload();
            }, 1000);
        }
    </script>
    
</body>
</html>
